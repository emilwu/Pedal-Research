# 模組規格說明

本文件詳細說明 MVP 版本中各模組的功能規格、資料結構與介面需求。

---

## 模組 1：用戶系統

### 1.1 功能說明

提供基本的用戶身份管理功能，支援後續的個人清單和使用額度追蹤。

### 1.2 資料結構

**用戶資料**
```
用戶
├── 唯一識別碼
├── Email（唯一）
├── 密碼（加密儲存）
├── 顯示名稱
├── 註冊時間
├── 最後登入時間
└── 帳戶狀態（啟用/停用）
```

**使用額度記錄**
```
額度記錄
├── 用戶識別碼
├── 日期
├── 智慧配對使用次數
├── 智慧配對每日上限
└── 最後更新時間
```

### 1.3 介面需求

| 頁面 | 功能 |
|-----|------|
| 註冊頁 | Email、密碼、顯示名稱輸入；Email 驗證 |
| 登入頁 | Email、密碼輸入；忘記密碼連結 |
| 密碼重設頁 | Email 輸入 → 發送重設連結 |
| 個人資料頁 | 顯示/編輯顯示名稱；查看使用額度 |

### 1.4 業務規則

- Email 格式驗證
- 密碼強度要求（長度、複雜度待定）
- 每日額度於 00:00 (UTC+8) 重設
- 同一 Email 不可重複註冊

---

## 模組 2：設備數據庫

### 2.1 功能說明

展示所有已研究的設備資料，提供搜尋與篩選功能。此模組為靜態展示，不需要 AI 即時處理。

### 2.2 設備類型

| 類型 | 英文代號 | 說明 |
|-----|---------|------|
| 效果器 | pedal | 各類吉他效果器 |
| 吉他 | guitar | 電吉他 |
| 音箱 | amp | 吉他音箱（含 Preamp） |

### 2.3 資料結構

**設備基本資料（通用）**
```
設備
├── 唯一識別碼
├── 設備類型（pedal/guitar/amp）
├── 品牌
├── 型號
├── 完整名稱
├── 簡介描述
├── 縮圖圖片網址
├── 建立時間
├── 最後更新時間
└── 資料來源（AI研究/手動輸入/初始導入）
```

**效果器專屬欄位**
```
效果器擴展
├── 效果器子類型（compressor/overdrive/delay/reverb/eq/modulation/utility）
├── 主要特性標籤[]
├── 音色特性描述
├── 建議設定[]
│   ├── 情境名稱
│   ├── 各旋鈕設定值
│   └── 說明
├── 適合音樂風格[]
├── 價格參考
└── 官方網站連結
```

**吉他專屬欄位**
```
吉他擴展
├── 琴身類型（solid/semi-hollow/hollow）
├── 拾音器類型（humbucker/single-coil/p90/wide-range）
├── 拾音器配置（例：HH, HSS, SS）
├── 主動/被動
├── 輸出等級（low/medium/high）
├── 音色特性描述
├── 適合音樂風格[]
├── 價格參考
└── 官方網站連結
```

**音箱專屬欄位**
```
音箱擴展
├── 音箱類型（tube/solid-state/hybrid/preamp）
├── 功率
├── 是否有效果迴路
├── 效果迴路類型（串聯/並聯/立體聲）
├── 通道數
├── 內建效果[]
├── 音色特性描述
├── 適合音樂風格[]
├── 價格參考
└── 官方網站連結
```

### 2.4 介面需求

| 頁面/元件 | 功能 |
|----------|------|
| 設備列表頁 | 分頁顯示；分類標籤切換（全部/效果器/吉他/音箱） |
| 搜尋元件 | 關鍵字即時搜尋（品牌、型號、名稱） |
| 篩選面板 | 依類型、品牌、子類型篩選 |
| 設備卡片 | 縮圖、名稱、品牌、簡介、類型標籤 |
| 設備詳情頁 | 完整規格、設定建議、適合風格、相關連結 |

### 2.5 初始數據導入

從現有系統 `shared/equipment_database/` 導入：
- 效果器：13+ 筆
- 吉他：4 筆
- 音箱：4 筆

**導入對應關係：**
- YAML 規格檔 → 結構化資料
- MD 報告檔 → 詳細描述內容

---

## 模組 3：設備研究請求

### 3.1 功能說明

允許登入用戶提交新設備的研究請求，系統排隊處理後，將結果加入公開數據庫。

### 3.2 資料結構

**研究請求**
```
研究請求
├── 唯一識別碼
├── 請求用戶識別碼
├── 設備類型（pedal/guitar/amp）
├── 品牌
├── 型號
├── 補充說明（選填）
├── 請求時間
├── 狀態（排隊中/處理中/完成/失敗）
├── 排隊位置
├── 預估完成時間
├── 開始處理時間
├── 完成時間
├── 結果設備識別碼（完成時填入）
└── 失敗原因（失敗時填入）
```

### 3.3 請求狀態流程

```
提交請求 → [排隊中] → [處理中] → [完成] → 加入數據庫
                              ↘ [失敗] → 通知用戶
```

### 3.4 介面需求

| 頁面/元件 | 功能 |
|----------|------|
| 研究請求表單 | 設備類型選擇、品牌輸入、型號輸入、補充說明 |
| 請求確認 | 檢查是否已存在相同設備；顯示預估等待時間 |
| 我的請求列表 | 查看歷史請求；狀態追蹤 |
| 請求詳情 | 當前狀態、排隊位置、預估時間、結果連結 |

### 3.5 業務規則

- 提交前檢查數據庫是否已有相同設備（品牌+型號）
- 檢查是否有相同設備正在排隊或處理中
- 排隊採用 FIFO（先進先出）
- 預估時間 = 排隊位置 × 平均處理時間
- 完成時發送 Email 通知
- 失敗時發送 Email 通知（含失敗原因）

### 3.6 AI 處理邏輯（概念）

研究流程參考現有 `1_pedal-researcher.md` Agent：
1. 搜尋官方產品網站
2. 搜尋產品手冊/規格
3. 搜尋評測文章
4. 彙整結構化資料
5. 生成設定建議
6. 存入數據庫

---

## 模組 4：個人設備清單

### 4.1 功能說明

讓登入用戶建立並管理個人擁有的設備清單，供智慧配對使用。

### 4.2 資料結構

**清單項目**
```
清單項目
├── 唯一識別碼
├── 用戶識別碼
├── 設備來源（數據庫/手動輸入）
├── 數據庫設備識別碼（來源為數據庫時）
├── 設備類型
├── 品牌
├── 型號
├── 顯示名稱（可自訂）
├── 備註
├── 加入時間
└── 最後更新時間
```

**手動輸入設備（擴展）**
```
手動設備資料
├── 清單項目識別碼
├── 設備子類型（效果器適用）
├── 拾音器類型（吉他適用）
├── 音箱類型（音箱適用）
└── 其他自訂欄位（彈性）
```

### 4.3 介面需求

| 頁面/元件 | 功能 |
|----------|------|
| 我的設備清單頁 | 分類顯示（效果器/吉他/音箱）；設備數量統計 |
| 添加設備 - 數據庫 | 搜尋數據庫 → 點選加入 |
| 添加設備 - 手動 | 填寫表單（類型、品牌、型號、基本屬性） |
| 編輯設備 | 修改顯示名稱、備註 |
| 刪除確認 | 確認刪除（不影響數據庫） |

### 4.4 業務規則

- 同一設備可重複加入（例：擁有兩把相同型號的吉他）
- 手動輸入的設備僅存在於個人清單
- 數據庫來源設備若更新，清單顯示同步更新
- 刪除清單項目不影響數據庫

---

## 模組 5：智慧配對

### 5.1 功能說明

根據用戶選擇的吉他、音箱、音樂風格，AI 計算並推薦最佳效果器組合與設定。

### 5.2 配對模式

| 模式 | 說明 | 設備來源 |
|-----|------|---------|
| 個人清單配對 | 使用自己擁有的設備 | 個人設備清單 |
| 假設性配對 | 模擬擁有某些設備 | 公開數據庫 |

### 5.3 資料結構

**配對請求**
```
配對請求
├── 唯一識別碼
├── 用戶識別碼
├── 配對模式
├── 選擇的吉他（清單項目ID 或 數據庫設備ID）
├── 選擇的音箱（清單項目ID 或 數據庫設備ID）
├── 音樂風格
├── 自定義風格描述（選填）
├── 可用效果器列表[]（清單項目ID 或 數據庫設備ID）
├── 請求時間
└── 結果識別碼
```

**配對結果**
```
配對結果
├── 唯一識別碼
├── 配對請求識別碼
├── 推薦 Compressor
│   ├── 設備資訊
│   └── 建議設定{}
├── 推薦 Overdrive
│   ├── 設備資訊
│   └── 建議設定{}
├── 推薦 EQ 調整
│   └── 建議設定{}
├── 推薦 Delay
│   ├── 設備資訊
│   └── 建議設定{}
├── 推薦 Reverb
│   ├── 設備資訊
│   └── 建議設定{}
├── 整體說明
├── 警告訊息[]（缺少必要設備等）
└── 生成時間
```

### 5.4 介面需求

| 頁面/元件 | 功能 |
|----------|------|
| 配對入口 | 選擇配對模式 |
| 設備選擇 - 個人清單 | 從清單選擇吉他、音箱、可用效果器 |
| 設備選擇 - 假設性 | 從數據庫搜尋選擇設備 |
| 風格選擇 | 預設選項 + 自定義輸入 |
| 額度提示 | 顯示今日剩餘次數；額度用完時的提示 |
| 配對結果頁 | 推薦組合、各設備設定值、說明、警告 |
| 歷史配對 | 查看過去的配對結果 |

### 5.5 音樂風格選項

**預設選項：**
- Jazz
- Neo Soul
- Funk
- Post Rock
- Fusion
- Blues

**自定義：**
- 用戶可輸入自定義風格描述
- AI 根據描述判斷配對邏輯

### 5.6 業務規則

- 每次配對消耗 1 次額度
- 額度不足時無法進行配對
- 至少需選擇 1 把吉他、1 台音箱
- 效果器可選可不選（不選則從數據庫推薦）
- 配對結果可儲存（綁定用戶）

### 5.7 AI 配對邏輯（概念）

參考現有 `guitar-pedal-pairing.md` Skill 和 `pairing_rules.yaml`：
1. 分析吉他特性（拾音器、輸出等級）
2. 分析音箱特性（類型、迴路）
3. 根據音樂風格取得需求
4. 從可用效果器中匹配最佳選擇
5. 計算各效果器的建議設定
6. 生成警告（缺少必要設備時）

---

## 模組 6：後台管理

### 6.1 功能說明

供管理員監控系統狀態和管理研究隊列。

### 6.2 介面需求

| 頁面 | 功能 |
|-----|------|
| 儀表板 | 用戶數、設備數、今日請求數、隊列長度 |
| 研究隊列 | 列表顯示排隊中/處理中的請求；手動處理/取消 |
| 系統狀態 | AI 處理狀態、錯誤日誌 |

### 6.3 管理員權限

- 查看所有研究請求
- 手動觸發/取消研究處理
- 查看系統錯誤日誌

---

## 模組間依賴關係

```
┌─────────────┐
│  用戶系統    │
└──────┬──────┘
       │ 用戶身份
       ▼
┌──────────────────────────────────────────────┐
│                                              │
│  ┌─────────────┐      ┌─────────────┐       │
│  │  設備數據庫  │◄─────│  研究請求   │       │
│  └──────┬──────┘      └─────────────┘       │
│         │ 設備資料                           │
│         ▼                                   │
│  ┌─────────────┐      ┌─────────────┐       │
│  │  個人清單   │─────►│  智慧配對   │       │
│  └─────────────┘      └─────────────┘       │
│                                              │
└──────────────────────────────────────────────┘
```

- **用戶系統** 為所有需登入功能的基礎
- **設備數據庫** 為資料核心，研究結果進入此處
- **個人清單** 依賴數據庫提供設備選項
- **智慧配對** 依賴個人清單或數據庫提供設備
